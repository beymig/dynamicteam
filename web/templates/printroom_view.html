{% extends "layout.html" %}
{% block body %}
<script>
var selected_printer = "";
function sendjob(taskid, printer){
  $.post("{{ url_for('sendjob') }}", 
    {
      taskid:taskid,
      printerid:selected_printer
      }, function(){
      window.location.href = "{{ url_for('show_tasks') }}";
      });
}

$( document ).ready(function() {
    $('#tasks .btn').attr('disabled', 'disabled');

    $('.navbar-nav li').removeClass('active');
    $('.navbar-nav #nav-printroom').addClass('active');
    $( '#printers .btn' ).on('click', function(){
      var btn = $(this);
      if ( btn.hasClass("btn-success")) {
        btn.removeClass('btn-success').addClass('btn-default');
        $('#tasks .dyt-task-new').attr('disabled', 'disabled');
        selected_printer = None;
      }else {
        $('#printers .btn-success').removeClass('btn-success').addClass('btn-default');
        btn.addClass('btn-success');
        $('#tasks .dyt-task-new').removeAttr('disabled');
        selected_printer = btn.attr('id');//btn.id;
        var a = selected_printer;
      }
    });
});
</script>
<div class="col-sm-9 col-sm-offset-3 col-md-9 col-md-offset-2 main">

  <div id="printers" class="row placeholders">
    <h2 class="page-header">Printers</h2>
    <div class="row">
      <div class="col-md-4">
        P-ERS
        <div role="toolbar" class="btn-toolbar">
          <div class="btn-group">
            {% for printer in (1,2,3,20,21,22) %}
            <button class="btn btn-default" id="P-ERS{{ "%02d"|format(printer) }}" type="button">{{ "%02d"|format(printer) }}</button>
            {% endfor %}
          </div>
        </div>
      </div>
      <div class="col-md-2">
        P-ER
        <div role="toolbar" class="btn-toolbar">
          <div class="btn-group">
            {% for printer in (1,2) %}
            <button class="btn btn-default" id="P-ER{{ "%02d"|format(printer) }}" type="button">{{ "%02d"|format(printer) }}</button>
            {% endfor %}
          </div>
        </div>
      </div>
      <div class="col-md-3">
        P-Mimaki
        <div role="toolbar" class="btn-toolbar">
          <div class="btn-group">
            {% for printer in (25, 26, 27) %}
            <button class="btn btn-default" id="P-Mimaki{{ "%02d"|format(printer) }}" type="button">{{ "%02d"|format(printer) }}</button>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      P-E
      <div role="toolbar" class="btn-toolbar">
        <div class="btn-group">
          {% for printer in range(4,19) %}
          <button class="btn btn-default" id="P-E{{ "%02d"|format(printer) }}" type="button">{{ "%02d"|format(printer) }}</button>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="row">
      P-EN
      <div role="toolbar" class="btn-toolbar">
        <div class="btn-group">
          {% for printer in range(4,19) %}
          <button class="btn btn-default" id="P-EN{{ "%02d"|format(printer) }}" type="button">{{ "%02d"|format(printer) }}</button>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>

  <div id="tasks" class="row placeholders">
    <h2 class="page-header">Pending Tasks</h2>
    <table class="table table-striped table-condensed">
      <thead>
        <tr>
          <th>Log</th>
          <th>Fabric</th>
          <th>DaysToGo</th>
          <th>Units</th>
          <th>Length</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for task in tasks %}
        <tr>
          <td>{{ task.log }}</td>
          <td>{{ task.fabric }}</td>
          <td>{{ task.daystogo }}</td>
          <td>{{ task.units }}</td>
          <td>{{ task.length }}</td>
          <td><button type="button" class="btn btn-sm {% if task.printer %} btn-warning dyt-task-assigned">To:{{ task.printer }} {% else %}btn-primary dyt-task-new" onclick="sendjob({{ task.id }}, selected_printer);">Send Task {% endif %}</button></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
